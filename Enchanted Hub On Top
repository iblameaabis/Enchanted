--[[

    Author: @iamvyxon
    Enchanted Hub maintainer: @iblameaabis | Discord: zziblameaabiszz
    GitHub: https://github.com/iamvyxon
    https://discord.gg/w2XcZQeANj

    NOTE: I do not maintain the Scripts, it is maintained by @iblameaabis.
    If you have any issues with the scripts, please contact him.
    This loader is for Enchanted Hub scripts only.
    If you want to use this loader for your own scripts, please Contact @iamvyxon on Discord.
      
-- ]]

local Loader = {}
Loader.__index = Loader

function Loader.new(cfg)
    local self      = setmetatable({}, Loader)
    self.cfg        = cfg
    local ok, fluent = pcall(function()
        return loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
    end)
    if not ok or not fluent then
        warn("[Enchanted Loader] Failed to load Fluent UI library!")
        return self
    end
    self.libs       = { Fluent = fluent }
    self:_initUI()
    return self
end

function Loader:_initUI()
    local Fluent    = self.libs.Fluent
    if not Fluent then warn("[Enchanted Loader] Fluent UI not available.") return end
    local win       = Fluent:CreateWindow(self.cfg.Window)
    if not win then warn("[Enchanted Loader] Failed to create window.") return end
    self.window     = win
    self.tabs       = {
        Scripts    = win:AddTab({ Title = "Scripts", Icon = "list" }),
        Info       = win:AddTab({ Title = "Info", Icon = "info" })
    }
    self:_addScriptButtons()
    self:_addInfo()
end

function Loader:_addScriptButtons()
    for _, script in ipairs(self.cfg.Scripts) do
        self.tabs.Scripts:AddButton({
            Title       = script.Name,
            Description = string.format("Click to load %s%s", script.Name, script.PlaceId and (" (PlaceId: " .. script.PlaceId .. ")") or ""),
            Tooltip     = script.Url,
            Callback    = function()
                if script.PlaceId and game.PlaceId ~= script.PlaceId then
                    self.libs.Fluent:Notify({
                        Title    = "Wrong Game!",
                        Content  = "This script can only be executed in place ID: " .. tostring(script.PlaceId),
                        Duration = 5
                    })
                    return
                end
                self:_loadScript(script.Url)
            end
        })
    end
end

function Loader:_loadScript(url)
    self.libs.Fluent:Notify({ Title = "Loading...", Content = url, Duration = 3 })
    if self.window and self.window.Destroy then self.window:Destroy() end
    if self.libs.Fluent and self.libs.Fluent.Unload then self.libs.Fluent:Unload() end
    local ok, err = pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    if not ok then warn("[Enchanted Loader Error]", err) end
end

function Loader:_addInfo()
    self.tabs.Info:AddParagraph({
        Title   = "About",
        Content = "Enchanted Hub Loader\nLoader by @iamvyxon | Scripts by @iblameaabis\nDiscord: zziblameaabiszz\nhttps://github.com/iamvyxon\n\nSelect a script from the Scripts tab. Loader UI will close after loading."
    })
end

local Config = {
    Window = {
        Title        = "Enchanted Hub Loader",
        SubTitle     = "Loader by @iamvyxon | Scripts by @iblameaabis",
        TabWidth     = 160,
        Size         = UDim2.fromOffset(580, 460),
        Acrylic      = true,
        Theme        = "Dark",
        MinimizeKey  = Enum.KeyCode.LeftControl
    },
    Scripts = {
        {
            Name    = "Enchanted Hub (Muscle Legends)",
            Url     = "https://raw.githubusercontent.com/iblameaabis/Enchanted/refs/heads/main/Enchanted%20Hub%20On%20Top",
            PlaceId = 3623096087
        },
        {
            Name    = "Enchanted Hub (Legends of Speed)",
            Url     = "https://raw.githubusercontent.com/iblameaabis/Enchanted/refs/heads/main/Legends%20Of%20Speed",
            PlaceId = 3101667897
        }
    }
}

Loader.new(Config)
